syntax = "proto3";

package lumbay2sv;

option go_package="lumbay2sv/main";

service LumbayLumbay {
    rpc SendRequest(Request) returns (Reply) {}
    rpc Subscribe(Empty) returns (stream Update) {}
}

message Update {
    int64 sequence_number = 1;
    oneof type {
        Ping ping = 2;
        YouAreInGameUpdate you_are_in_game_update = 3;
        WaitingForOtherPlayerUpdate waiting_for_other_player_update = 4;
        ReadyToStartUpdate ready_to_start_update = 5;
        GameCodeGeneratedUpdate game_code_generated = 6;
        YouQuitTheGameUpdate you_quit_the_game_update = 7;
        GameStartedUpdate game_started_update = 8;
        WorldUpdate world_update = 9;
        WorldRegionStatusUpdate world_region_status_update = 10;
        WorldObjectUpdate world_object_update = 11;
    }
}

message Request {
    oneof type {
        AcquireClientIdRequest acquire_client_id_request = 1;
        AcquirePublicKeyRequest acquire_public_key_request = 2;
        CreateGameRequest create_game_request = 3;
        GenerateGameCodeRequest generate_game_code_request = 4;
        JoinGameRequest join_game_request = 5;
        QuitGameRequest quit_game_request = 6;
        StartGameRequest start_game_request = 7;
        ProcessWorldObjectRequest process_world_object_request = 8;
    }
}

message Reply {
    oneof type {
        AcquireClientIdReply acquire_client_id_reply = 1;
        AcquirePublicKeyReply acquire_public_key_reply = 2;
        CreateGameReply create_game_reply = 3;
        GenerateGameCodeReply generate_game_code_reply = 4;
        JoinGameReply join_game_reply = 5;
        QuitGameReply quit_game_reply = 6;
        StartGameReply start_game_reply = 7;
        ProcessWorldObjectReply process_world_object_reply = 8;
    }
}

message Empty {}

message AcquireClientIdRequest {
}

message AcquirePublicKeyRequest {
    string name = 1;
}

message AcquireClientIdReply {
    string client_id = 1;
}

message AcquirePublicKeyReply {
    string public_key = 1;
}

message CreateGameRequest {
}

message CreateGameReply {
}

message GenerateGameCodeRequest {
}

message GenerateGameCodeReply {
}

message JoinGameRequest {
    string gameCode = 1;
}

message JoinGameReply {
}

message QuitGameRequest {
}

message QuitGameReply {
}

message StartGameRequest {
}

message StartGameReply {
}

message ProcessWorldObjectRequest {
    WorldId world_id = 1;
    WorldRegionId world_region_id = 2;
    WorldObject world_object = 3;
}

message ProcessWorldObjectReply {
}

message Game {
    string id = 1;
    string player1 = 2;
    string player2 = 3;
    GameStatus status = 4;
}

message Client {
    string id = 1;
    string salt = 2;
}

message World {
    WorldId id = 1;
    WorldStatus status = 3;
    WorldRegionId current_region_id = 4;
    repeated WorldRegion regions = 5;
}

message WorldRegion {
    WorldRegionId id = 1;
    WorldRegionStatus status = 3;
    WorldLocation location = 4;
    repeated WorldObject objects = 5;
}

message WorldLocation {
    int64 x = 1;
    int64 y = 2;
    int64 z = 3;
}

message WorldObject {
    WorldObjectId id = 1;
    WorldObjectStatus status = 2;
    WorldLocation location = 3;
}

message Ping {
}

message YouAreInGameUpdate {
}

message WaitingForOtherPlayerUpdate {
}

message ReadyToStartUpdate {
}

message GameCodeGeneratedUpdate {
    string game_code = 1;
}

message YouQuitTheGameUpdate {
}

message GameStartedUpdate {
}

message WorldUpdate {
    World world = 1;
}

message WorldRegionStatusUpdate {
    WorldId world_id = 1;
    WorldRegionId world_region_id = 2;
    WorldStatus status = 3;
}

message WorldObjectUpdate {
    WorldId world_id = 1;
    WorldRegionId world_region_id = 2;
    WorldObject world_object = 3;
}

enum GameStatus {
    NONE = 0;
    WAITING_FOR_OTHER_PLAYER = 1;
    READY_TO_START = 2;
    STARTED = 3;
}

enum WorldStatus {
    WORLD_STATUS_NOTHING = 0;
}

enum WorldRegionStatus {
    WORLD_REGION_STATUS_NOTHING = 0;

    WORLD_ONE_REGION_STATUS_PLAYER_1_TO_MOVE = 1;
    WORLD_ONE_REGION_STATUS_PLAYER_2_TO_MOVE = 2;
    WORLD_ONE_REGION_STATUS_PLAYER_1_WINS = 3;
    WORLD_ONE_REGION_STATUS_PLAYER_2_WINS = 4;
    WORLD_ONE_REGION_STATUS_DRAW = 5;
}

enum WorldObjectStatus {
    WORLD_OBJECT_STATUS_NOTHING = 0;
    
    WORLD_ONE_OBJECT_STATUS_SPAWNED = 1;
    WORLD_ONE_OBJECT_STATUS_MOVED = 2;
}

enum WorldId {
    WORLD_ID_NOTHING = 0;
    WORLD_ID_WORLD_ONE = 1;
}

enum WorldRegionId {
    WORLD_REGION_NOTHING = 0;
    WORLD_ONE_REGION_ONE = 1;
}

enum WorldObjectId {
    WORLD_OBJECT_NOTHING = 0;

    WORLD_ONE_OBJECT_STONE_1 = 1;
    WORLD_ONE_OBJECT_STONE_2 = 2;
}